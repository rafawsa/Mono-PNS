---
title: "analise-Plano-Saúde"
author: "Rafawsa"
format: html
editor: visual
---

## Análise de uso de serviços de saúde por ter ou não plano de saúde privado

```{r}
#| warning: false

# Bibliotecas ----
library(tidyverse) # utilizar a sintaxe tidyverse com o R
library(survey)    # análise de pesquisas complexas
library(srvyr)     # provê notação tidyverse para o pacote survey 
library(PNSIBGE)   # acesso aos dados da PNS
library(broom)     # sumariza as informações dos modelos em formato tidy

```

### Acesso aos Dados da PNS 2013 e 2019

Para acessar os dados da PNS usaremos as funções do pacote PNSIBGE:

```{r}
#| warning: false

source("read-pns-data.R")
rm(var_pns_2013)
rm(var_pns_2019)
rm(pns13)
rm(pns19)
rm(dfpns13)
rm(dfpns19)


```

### Funções para Cálculo da Razão de Prevalência Bruta e Ajustada (Poisson)

```{r}
#| echo: false
#| warning: false

source("razao-prevalencia-bruta.R")
source("razao-prevalencia-ajustada.R")

```

#### Prevalência no uso de serviços de saúde tendo ou não Plano de Saúde Privado

Vamos calcular a prevalência bruta da população com DCNT em relação à população sem DCNT para as variáveis desfecho:

-   J014 - Uso de serviços de saúde nas duas últimas semanas,

-   J037 - Internação nos últimos 12 meses,

-   J002 - Deixar de realizar atividades nas duas últimas semanas por motivo de saúde

-   J011 - Consulta médica nos últimos 12 meses".

#### Cenário 12 - Razão de prevalência do uso de serviços de saúde para a Exposição possuir ou não plano de saúde privado

```{r}
#| warning: false

c12_pns13_plano <- 
  tibble(
    desfecho = c("J014", "J037", "J002", "J011")  # variáveis investigadas
  )
c12_pns19_plano <- 
  tibble(
    desfecho = c("J014", "J037", "J002", "J011")  # variáveis investigadas
  )

```

```{r}
#| warning: false

# RP Bruta:
c12_pns13_plano <- 
  c12_pns13_plano |> 
  mutate(rp_bruta = map(desfecho, ~ calc_rp_bruta(svy13, "I001", .x,
                                                  exp_pos = "Não", exp_neg = "Sim",
                                                  des_pos = "Sim", des_neg = "Não"))) |> 
  unnest(rp_bruta) 

c12_pns19_plano <- 
  c12_pns19_plano |> 
  mutate(rp_bruta = map(desfecho, ~ calc_rp_bruta(svy19, "I00101", .x,
                                                  exp_pos = "Não", exp_neg = "Sim",
                                                  des_pos = "Sim", des_neg = "Não"))) |> 
  unnest(rp_bruta) 

```

```{r}
#| warning: false
# RP Ajustada
c12_pns13_plano <- 
  c12_pns13_plano |> 
  mutate(data = map(desfecho, ~ calc_razao_prevalencia_ajustada(svy13, "I001", .x,
                                                                exp_pos = "Não", exp_neg = "Sim",
                                                                des_pos = "Sim", des_neg = "Não"))) |> 
  unnest(data)

c12_pns19_plano <- 
  c12_pns19_plano |> 
  mutate(data = map(desfecho, ~ calc_razao_prevalencia_ajustada(svy19, "I00101", .x,
                                                                exp_pos = "Não", exp_neg = "Sim",
                                                                des_pos = "Sim", des_neg = "Não"))) |> 
  unnest(data)


```

```{r}
#| warning: false
# Resultados:

# Cenário 12 - Razão de prevalência do uso de serviços de saúde para a Exposição possuir ou não plano de saúde privado - PNS 2013
(c12_pns13_plano)

# Cenário 12 - Razão de prevalência do uso de serviços de saúde para a Exposição possuir ou não plano de saúde privado - PNS 2019
(c12_pns19_plano)

```

### Cenário 13 - Razão de prevalência do uso de serviços de saúde para a Exposição possuir ou não Plano de Saúde Privado para a população portadora de DCNT

```{r}
#| warning: false

c13_pns13_dcnt <- 
  tibble(
    desfecho = c("J014", "J037", "J002", "J011"),   # variáveis investigadas
  )
c13_pns19_dcnt <- 
  tibble(
    desfecho = c("J014", "J037", "J002", "J011"),   # variáveis investigadas
  )

```

```{r}
#| warning: false
# Dados:

c13_svy13_dcnt <- 
  svy13 |> 
    srvyr::filter(J007 == "Sim") 

c13_svy19_dcnt <- 
  svy19 |> 
    srvyr::filter(J007 == "Sim") 

```

```{r}
#| warning: false
# RP Bruta:
c13_pns13_dcnt <- 
  c13_pns13_dcnt |> 
  mutate(rp_bruta = map(desfecho, ~ calc_rp_bruta(c13_svy13_dcnt, "I001", .,
                                                  exp_pos = "Não", exp_neg = "Sim",
                                                  des_pos = "Sim", des_neg = "Não"))) |>  
  unnest(rp_bruta) 

c13_pns19_dcnt <- 
  c13_pns19_dcnt |> 
  mutate(rp_bruta = map(desfecho, ~ calc_rp_bruta(c13_svy19_dcnt, "I00101", .,
                                                  exp_pos = "Não", exp_neg = "Sim",
                                                  des_pos = "Sim", des_neg = "Não"))) |>
  unnest(rp_bruta) 


```

```{r}
#| warning: false
# RP Ajustada:
c13_pns13_dcnt <- 
  c13_pns13_dcnt |> 
  mutate(data = map(desfecho, ~ calc_razao_prevalencia_ajustada(c13_svy13_dcnt, 
                                                                "I001",.,
                                                  exp_pos = "Não", exp_neg = "Sim",
                                                  des_pos = "Sim", des_neg = "Não"))) |>
  unnest(data)

c13_pns19_dcnt <- 
  c13_pns19_dcnt |> 
  mutate(data = map(desfecho, ~ calc_razao_prevalencia_ajustada(c13_svy19_dcnt, 
                                                                "I00101",.,
                                                  exp_pos = "Não", exp_neg = "Sim",
                                                  des_pos = "Sim", des_neg = "Não"))) |>
  unnest(data)

```

```{r}
#| warning: false
# Resultados:

# Cenário 13 - Razão de prevalência do uso de serviços de saúde para a Exposição possuir ou não Plano de Saúde Privado para a população portadora de DCNT - PNS 2013
(c13_pns13_dcnt)

# Cenário 13 - Razão de prevalência do uso de serviços de saúde para a Exposição possuir ou não Plano de Saúde Privado para a população portadora de DCNT - PNS 2019
(c13_pns19_dcnt)

```

### Cenário 14 - Razão de prevalência do uso de serviços de saúde para a Exposição de possuir ou não plano de saúde privado para a população Não portadora de DCNT

```{r}
#| warning: false

c14_pns13_no_dcnt <- 
  tibble(
    desfecho = c("J014", "J037", "J002", "J011"),   # variáveis investigadas
  )
c14_pns19_no_dcnt <- 
  tibble(
    desfecho = c("J014", "J037", "J002", "J011"),   # variáveis investigadas
  )

```

```{r}
#| warning: false

c14_svy13_no_dcnt <- 
  svy13 |> 
    srvyr::filter(J007 == "Não")

c14_svy19_no_dcnt <- 
  svy19 |> 
    srvyr::filter(J007 == "Não") 

```

```{r}
#| warning: false
# RP Bruta:
c14_pns13_no_dcnt <- 
  c14_pns13_no_dcnt |> 
  mutate(rp_bruta = map(desfecho, ~ calc_rp_bruta(c14_svy13_no_dcnt, "I001", .,
                                                  exp_pos = "Não", exp_neg = "Sim",
                                                  des_pos = "Sim", des_neg = "Não"))) |>
  unnest(rp_bruta) 

c14_pns19_no_dcnt <- 
  c14_pns19_no_dcnt |> 
  mutate(rp_bruta = map(desfecho, ~ calc_rp_bruta(c14_svy19_no_dcnt, "I00101", .,
                                                  exp_pos = "Não", exp_neg = "Sim",
                                                  des_pos = "Sim", des_neg = "Não"))) |> 
  unnest(rp_bruta) 

```

```{r}
#| warning: false
# RP Ajustada:
c14_pns13_no_dcnt <- 
  c14_pns13_no_dcnt |> 
  mutate(data = map(desfecho, ~ calc_razao_prevalencia_ajustada(c14_svy13_no_dcnt, 
                                                                "I001",.,
                                                  exp_pos = "Não", exp_neg = "Sim",
                                                  des_pos = "Sim", des_neg = "Não"))) |>
  unnest(data)

c14_pns19_no_dcnt <- 
  c14_pns19_no_dcnt |> 
  mutate(data = map(desfecho, ~ calc_razao_prevalencia_ajustada(c14_svy19_no_dcnt, 
                                                                "I00101",.,
                                                  exp_pos = "Não", exp_neg = "Sim",
                                                  des_pos = "Sim", des_neg = "Não"))) |>
  unnest(data)

```

```{r}
#| warning: false
# Resultados:

# Cenário 14 - Razão de prevalência do uso de serviços de saúde para a Exposição de possuir ou não plano de saúde privado para a população Não portadora de DCNT - PNS 2013
(c14_pns13_no_dcnt)

# Cenário 14 - Razão de prevalência do uso de serviços de saúde para a Exposição de possuir ou não plano de saúde privado para a população Não portadora de DCNT - PNS 2019
(c14_pns19_no_dcnt)

```
